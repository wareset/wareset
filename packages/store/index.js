/* eslint-disable */
function n(){}var t,u=[],e=function(t,l){function i(n){throw"@wareset/signal: "+n}var s=Object.is||function(n,t){return n===t?0!==n||1/n==1/t:n!=n&&t!=t};var o=null;function c(n){for(var t=n.length;t-- >0;)n[t].t=n[t].u=!0,c(n[t].s._.w)}var f={};function a(n){if(0===n.l&&n.g!==f&&(n.t||n.s._.s.n===n.s._.s)){n.l++;var t,u=o;if(o=null,!n.u)for(var e=0;e<n.x.length;e++)if(n.i[e]._.c&&a(n.i[e]._.c),!s(n.x[e].v,n.i[e]._value)){n.u=!0;break}if(n.u){n.m=f,o=n.o?null:n,t=n.c(n.s._value,n.o&&function(n){for(var t=Array(n.length),u=0;u<n.length;u++)t[u]=r(n[u])?n[u].get():n[u];return t}(n.o)),o=null;for(var l=n.x.length;l-- >0;)n.o||n.x[l].m===n.m?n.x[l].v=n.i[l]._value:(n.i.splice(l,1),n.x.splice(l,1)[0].u())}o=u,n.g=f,n.t=!1,n.l--,n.u&&(n.u=!1,n.s.set(t,n.s._.r&&n.s._.r(_)))}}function v(n,t){var u=t._.w;u.push(n),n.l++;var e=t.subscribe(n.f);return n.l--,function(){u.splice(u.lastIndexOf(n),1),e()}}function p(t,u){if(u!==t.s){var e=t.i.indexOf(u);e<0?(t.i.push(u),t.x.push({m:t.m,v:t.s._value,u:t.s._.s.n!==t.s._.s?v(t,u):n})):t.x[e].m=t.m}}function _(n){return function(t){return t===_?n:null}}var h=function(){function WaresetSignal(n,t){this._={i:-1,s:{p:null,n:null},n:null,r:t&&null!=t.protect?_(t.protect):null,p:t&&t.control||null,f:t&&t.prepare||null,l:null,w:[],c:null},this._.s.p=this._.s.n=this._.n=this._.s,this._value=n,t&&t.compute&&function(n,t,u){var e=0,l=n._.c={s:n,c:t,o:null,i:[],x:[],g:null,t:!0,u:!0,m:null,l:0,f:function(){if(0===l.l&&l.g!==f&&l.t){if(e<=0){e=0;for(var n=0;n<l.x.length;n++)l.i[n]._.c&&a(l.i[n]._.c),s(l.x[n].v,l.i[n]._value)||e++}0==--e&&a(l)}}};if(u){for(var i=[],o=0;o<u.length;o++)r(u[o])&&p(l,u[o]),i.push(u[o]);l.o=i}}(this,t.compute,t.observe)}var t=WaresetSignal.prototype;return t.get=function(){var t=this._,u=o;o=null,u&&p(u,this);var e=t.s.n===t.s&&(t.c||t.f)?this.subscribe(n):t.c&&a(t.c),r=this._value;return e&&e(),o=u,r},t.set=function(n,t){var e=this._;return e.r&&e.r(_)!==t&&i("protect"),e.c&&function(n){if(0===n.l&&n.g!==f){n.l++;var t=o;o=null,n.m||n.o||(n.m=f,o=n,n.c(n.s._value,null),o=null);for(var u=0;u<n.x.length;u++)n.i[u]._.c&&a(n.i[u]._.c),n.x[u].v=n.i[u]._value;o=t,n.g=f,n.t=!1,n.l--,n.u=!1}}(e.c),s(this._value,this._value=e.p?e.p(n,this._value):n)||(f={},e.c&&(e.c.g=f),c(e.w),function(n){if(u.length>4e4&&i("queue cycle"),0==(n._.i=u.push(n)-1)){for(var t,e=0;e<u.length;e++)if((t=(n=u[e])._).i===e)for(t.n=t.s;(t.n=t.n.n)!==t.s&&(t.c&&a(t.c),t.i===e);)s(t.n.v,t.n.v=n._value)||t.n.f(t.n.v);u=[]}}(this)),this},t.subscribe=function(t){var u=this,e=u._,r={v:null,p:null,n:null,f:n};return e.n=(r.p=(r.n=e.n===e.s?e.s:e.n.n).p).n=r.n.p=r,e.s.n===r&&(e.c&&function(t){for(var u=0;u<t.x.length&&t.s._.s.n!==t.s._.s;u++)t.x[u].u===n&&(t.x[u].u=v(t,t.i[u]));t.t=!0,a(t)}(e.c),e.f&&(e.l=e.f(u))),(r.f=t)(r.v=u._value),function(){r&&(r.p.n=r.n,r.n.p=r.p,r.f=n,r=null,e.s.n===e.s&&(e.l&&e.l(u),e.c&&function(t){for(var u,e=t.x.length;e-- >0&&t.s._.s.n===t.s._.s;)u=t.x[e].u,t.x[e].u=n,u()}(e.c)))}},t.toString=function(){var n=this.get();return null!=n&&n.toString?n.toString.apply(n,arguments):""+n},t.valueOf=function(){var n=this.get();return null!=n&&n.valueOf?n.valueOf.apply(n,arguments):n},t.toJSON=function(){var n=this.get();return null!=n&&n.toJSON?n.toJSON.apply(n,arguments):n},WaresetSignal}(),g=(e=h).prototype;return Object.defineProperty(g,"$",{get:g.get,set:g.set}),new e(t,l)};function r(n){return n instanceof e}exports.batch=function(r){t||(t=new e({f:n})).subscribe((function(n){n.f()})),u.length>0?r():t.set({f:r})},exports.computed=function(n,t){return new e(void 0,{compute:t,observe:n})},exports.effect=function(t,u,r){return new e(void 0,{compute:u,observe:t}).subscribe(r||n)},exports.isSignal=r,exports.isSignalProtected=function(n){return n instanceof e&&!!n._.r},exports.signal=function(n,t){return new e(n,t)};
